<!DOCTYPE html> <!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]--> <!--[if (IE 7)&!(IEMobile)]><html class="no-js lt-ie9 lt-ie8"><![endif]--> <!--[if (IE 8)&!(IEMobile)]><html class="no-js lt-ie9"><![endif]--> <!--[if gt IE 8]><!--> <html class="no-js"><!--<![endif]--> <head> <title>IU - Blue</title> <!-- Handheld --> <meta name="HandheldFriendly" content="True"> <meta name="MobileOptimized" content="320"> <meta name="viewport" content="width=device-width, initial-scale=1.0"> <!-- Favicons --> <!-- <link rel="apple-touch-icon" href="//www.sgheartiu.com/assets/img/favicons/apple-icon-precomposed.png"> --> <link rel="apple-touch-icon" sizes="72x72" href="//www.sgheartiu.com/assets/img/favicons/apple-touch-icon-72x72.png"> <link rel="apple-touch-icon" sizes="114x114" href="//www.sgheartiu.com/assets/img/favicons/apple-touch-icon-114x114.png"> <link rel="apple-touch-icon" sizes="144x144" href="//www.sgheartiu.com/assets/img/favicons/apple-touch-icon-144x144.png"> <link rel="shortcut icon" type="image/png" href="//www.sgheartiu.com/favicon.png" /> <link rel="shortcut icon" href="//www.sgheartiu.com/favicon.ico" /> <link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon-180x180.png"> <link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"> <link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"> <link rel="manifest" href="/assets/img/favicons/site.webmanifest"> <link rel="mask-icon" href="/assets/img/favicons/safari-pinned-tab.svg" color="#6cd55b"> <link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"> <meta name="msapplication-TileColor" content="#00a300"> <meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"> <meta name="theme-color" content="#ffffff"> <!-- Splashscreen for iOS Web App --> <link href="//www.sgheartiu.com/assets/img/favicons/splashscreens/iphone5_splash.png" media="(device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2)" rel="apple-touch-startup-image" /> <link href="//www.sgheartiu.com/assets/img/favicons/splashscreens/iphone6_splash.png" media="(device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2)" rel="apple-touch-startup-image" /> <link href="//www.sgheartiu.com/assets/img/favicons/splashscreens/iphoneplus_splash.png" media="(device-width: 621px) and (device-height: 1104px) and (-webkit-device-pixel-ratio: 3)" rel="apple-touch-startup-image" /> <link href="//www.sgheartiu.com/assets/img/favicons/splashscreens/iphonex_splash.png" media="(device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3)" rel="apple-touch-startup-image" /> <link href="//www.sgheartiu.com/assets/img/favicons/splashscreens/iphonexr_splash.png" media="(device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 2)" rel="apple-touch-startup-image" /> <link href="//www.sgheartiu.com/assets/img/favicons/splashscreens/iphonexsmax_splash.png" media="(device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 3)" rel="apple-touch-startup-image" /> <link href="//www.sgheartiu.com/assets/img/favicons/splashscreens/ipad_splash.png" media="(device-width: 768px) and (device-height: 1024px) and (-webkit-device-pixel-ratio: 2)" rel="apple-touch-startup-image" /> <link href="//www.sgheartiu.com/assets/img/favicons/splashscreens/ipadpro1_splash.png" media="(device-width: 834px) and (device-height: 1112px) and (-webkit-device-pixel-ratio: 2)" rel="apple-touch-startup-image" /> <link href="//www.sgheartiu.com/assets/img/favicons/splashscreens/ipadpro3_splash.png" media="(device-width: 834px) and (device-height: 1194px) and (-webkit-device-pixel-ratio: 2)" rel="apple-touch-startup-image" /> <link href="//www.sgheartiu.com/assets/img/favicons/splashscreens/ipadpro2_splash.png" media="(device-width: 1024px) and (device-height: 1366px) and (-webkit-device-pixel-ratio: 2)" rel="apple-touch-startup-image" /> <!-- Manifest --> <link rel="manifest" href="/manifest.json"> <meta name="mobile-web-app-capable" content="yes"> <meta name="apple-mobile-web-app-capable" content="yes"> <meta name="viewport" content="width=device-width, initial-scale=1"> <meta http-equiv="cache-control" content="max-age=0" /> <meta http-equiv="cache-control" content="no-cache" /> <meta http-equiv="expires" content="0" /> <meta http-equiv="expires" content="Tue, 01 Jan 1980 1:00:00 GMT" /> <meta http-equiv="pragma" content="no-cache" /> <link rel="stylesheet" href="/assets/css/overlay-terence.css"> <script src="/assets/js/overlay-terence.js"></script> <script src="/assets/js/NoSleep.min.js"></script> <script src="/assets/js/jquery-1.12.0.min.js"></script> </head> <body bgcolor="#71ABFA"> <!-- START OF blinking div --> <style> @keyframes blinking { 0%{ background-color: #1800ff; border: 5px solid #1800ff; } 50%{ background-color: #7dabf4; border: 5px solid #7dabf4; } 100%{ background-color: #1800ff; border: 5px solid #1800ff; } } #fullscreen{ position: fixed; top: 0; left: 0; bottom: 0; right: 0; overflow: auto; /* NAME | TIME | ITERATION */ animation: none; } </style> <div id="fullscreen"></div> <!-- END OF blinking div --> <!-- START OF @TerenceTanWT CUSTOM BANNER OVERLAY --> <!-- overlay-terence.css and overlay-terence.js are linked in head.html. To disable banner, simply hide in by modifying overlay-terence.css under .display --> <div id="overlay-blue" onclick="overlayBlueOff();"> <div id="overlay-banner-blue"> <h3> Blue Ocean Event (7 Dec)</h3> <font color="red"><b><i> This event is strictly for 7 Dec only</i></b></font> <br> Dear Singaenas, <br> Please use this flashing blue light for the song <b>Love Poem</b>: <br> 1. Set maximum screen brightness. <br> 2. Switch off fingerlights and lightsticks. <br> 3. Wave your phone with the blue screen facing IU when she sings <b>Love Poem</b>. <br><br> Please do not use private browsing mode. <br><br> <font color="pink">[Highly Recommended]</font> To prevent loading issues during the event, add this web page to your home screen and launch from there! <br><br> <font color="red"><b> [Tap to close this message] </b></font> </div> </div> <script> window.onload = setTimeout(overlayBlueOn,1500); </script> <!-- 3sec delay before banner popup. Comment out this line to disable banner --> <!-- END OF @TerenceTanWT CUSTOM BANNER OVERLAY --> <!-- START OF javascript functions to sync the blinking--> <script> try { if (localStorage.getItem("cacheDelay") !== null) { var cacheDelay = localStorage.getItem("cacheDelay"); } else { var cacheDelay = 0; } } catch(e) { /* DO NOTHING */ } function startBlink() { var blinkDiv = document.getElementById("fullscreen"); blinkDiv.style.animation = 'blinking 5s infinite'; console.log('Started Blinking at : ' + (new Date()).getTime()); } function stopBlink() { var blinkDiv = document.getElementById("fullscreen"); blinkDiv.style.animation = 'none'; } function startNow() { var localTime = parseInt((new Date()).getTime()) + parseInt(cacheDelay); console.log(" "); console.log('Delay: ' + cacheDelay); console.log('Local Time w/o Delay: ' + (localTime - cacheDelay)); console.log('Local Time w/ Delay : ' + localTime); var countdown = localTime % 5000; countdown = 5000 - countdown; setTimeout(startBlink, countdown); } </script> <!-- END OF javascript functions to sync the blinking--> <!-- START OF NoSleep.js --> <script> var noSleep = new NoSleep(); var toggleEl = document.querySelector("#overlay-blue"); toggleEl.addEventListener('click', function enableNoSleep() { toggleEl.removeEventListener('click', enableNoSleep, false); noSleep.enable(); startNow(); /* toggleEl.value = "Wake Lock is enabled"; document.body.style.backgroundColor = "green"; */ }, false); </script> <!-- END OF NoSleep.js --> <script> function sync() { var times = localStorage.getItem("times"); times = times + 1; localStorage.setItem("times", times); var http = new XMLHttpRequest(); http.timeout = 3000; var url = 'https://admin.ntuevents.com/api/iuconcert/time'; http.open('GET', url, true); var beforeTime = (new Date()).getTime(); http.onreadystatechange = function() { if(http.readyState == 4) { var localTime = (new Date().getTime()); console.log('Local Time: ' + localTime); var responseTime = parseInt(localTime) - parseInt(beforeTime); var onlineTime = parseInt(http.responseText) + parseInt(responseTime); console.log('Server Time: ' + onlineTime); delay = onlineTime - localTime; console.log('Network Response Time: ' + responseTime); console.log('Delay: ' + delay); console.log(" "); localStorage.setItem("times"+times, delay); if (times <= 111) { /* This is not eleven This is two LOL */ setTimeout(function() { sync(); }, 1000); } else { calculateDelay(); createLogs(); } } }; http.send(); } var delayStatus; function calculateDelay() { var delay1 = localStorage.getItem("times1"); var delay2 = localStorage.getItem("times11"); var delay3 = localStorage.getItem("times111"); var delay4 = localStorage.getItem("times1111"); var averageDelay = Math.round((parseInt(delay2) + parseInt(delay3) + parseInt(delay4)) / 3); console.log('Average Delay: ' + averageDelay); localStorage.setItem("averageDelay", averageDelay); /* If delays of the 4 queries is less than 50ms from each other, it is reliable */ if ((Math.abs(delay2-delay3) < 50) && (Math.abs(delay2-delay4) < 50) && (Math.abs(delay3-delay4) < 50)) { var absAverageDelay = Math.abs(averageDelay); if (absAverageDelay > 200) { /* If delay > 100ms, set permanent delay */ localStorage.setItem("cacheDelay", averageDelay); console.log('Device time varies by ' + averageDelay + 'ms. Setting permanent delay.'); delayStatus = "DSet"; } else { localStorage.setItem("cacheDelay", 0); console.log('Delay is < 100ms. Assume 0 ms.'); delayStatus = "DAssume0"; } } else { console.log('4 x query delays varies more than 100ms, inaccurate! Ignore!'); delayStatus = "DIgnore"; document.getElementById('overlay-banner-blue').innerHTML += '<br><br><br><font size="3" color="lime">If you see this green message, refresh this page until the message disappears. A faster Internet (e.g. home Wi-Fi) may help.' + ' <br><b>Ignore and close this message during the actual fan event. </b></font>'; } } function clearDelayCounter() { localStorage.removeItem("cacheDelay"); localStorage.removeItem("times"); localStorage.removeItem("times1"); localStorage.removeItem("times11"); localStorage.removeItem("times111"); localStorage.removeItem("times1111"); localStorage.removeItem("averageDelay"); } function createLogs() { var data; $.getJSON('https://api.ipify.org?format=json', function(data) { var ip = data.ip; var userAgent = navigator.userAgent; var dateTime = new Date().toLocaleString("en-US", {timeZone: "Asia/Singapore"}); dateTime = new Date(dateTime).toLocaleString(); var delay1 = localStorage.getItem("times1"); var delay2 = localStorage.getItem("times11"); var delay3 = localStorage.getItem("times111"); var delay4 = localStorage.getItem("times1111"); var averageDelay = localStorage.getItem("averageDelay"); var log = dateTime + ' | ' + ip + ' | ' + userAgent + ' | ' + delay1 + ' | ' + delay2 + ' | ' + delay3 + ' | ' + delay4 + ' | ' + averageDelay + '-' + delayStatus; console.log(log); sendLogs(log); }); } function createNoCookieLogs() { var data; $.getJSON('https://api.ipify.org?format=json', function(data) { var ip = data.ip; var userAgent = navigator.userAgent; var dateTime = new Date().toLocaleString("en-US", {timeZone: "Asia/Singapore"}); dateTime = new Date(dateTime); var log = dateTime + ' | ' + ip + ' | ' + userAgent + ' | ' + 'No Cookies'; console.log(log); sendLogs(log); }); } function sendLogs(logs) { var logJSON = { userinfo:logs }; logJSON = JSON.stringify(logJSON); const Http = new XMLHttpRequest(); const url='https://admin.ntuevents.com/api/iuconcert/delay'; Http.open("POST", url, true); Http.setRequestHeader("Content-Type", "application/json"); Http.send(logJSON); Http.onreadystatechange = (e) => { console.log(Http.responseText); if (delayStatus === "DSet") { window.setTimeout(window.location.reload.bind(window.location), 500); } } } window.onload = function() { try { /* clearDelayCounter(); */ /* COMMENT OUT DURING PRODUCTION */ if (localStorage.getItem("cacheDelay") === null || localStorage.getItem("version") !== "1") { localStorage.setItem("version", "1"); localStorage.setItem("cookieTest", "cookieTest"); localStorage.removeItem("cookieTest"); clearDelayCounter(); window.onload = setTimeout(function() { sync(); }, 1000); } } catch(e) { createNoCookieLog(); } }; </script> </body> </html>
